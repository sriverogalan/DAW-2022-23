<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PIANO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
  </head>

  <body class="bg">
    <div class="div-title">
      <h1>Score Finder</h1>
    </div>
    <div class="piano">
      <div class="btn-white" id="do"></div>
      <div class="btn-white" id="re">
        <div class="btn-black" id="do-sust"></div>
      </div>
      <div class="btn-white" id="mi">
        <div class="btn-black" id="re-sust"></div>
      </div>
      <div class="btn-white" id="fa"></div>
      <div class="btn-white" id="sol">
        <div class="btn-black" id="fa-sust"></div>
      </div>
      <div class="btn-white" id="la">
        <div class="btn-black" id="sol-sust"></div>
      </div>
      <div class="btn-white" id="si">
        <div class="btn-black" id="la-sust"></div>
      </div>
      <div class="btn-white" id="do7"></div>
    </div>

    <div class="piano-dev">
      <div class="search-song">
        <h2>CERCANT...</h2>
        <p id="cerca"></p>
        <button class="btn-red" onclick="borrarCerca()">Esborrar</button>
      </div>
      <div class="results">
        <h2>RESULTATS:</h2>
        <div id="resultats"></div>
      </div>
    </div>
  </body>
  <script>
    const notes = [
      "do",
      "re",
      "mi",
      "fa",
      "sol",
      "la",
      "si",
      "do-sust",
      "re-sust",
      "fa-sust",
      "sol-sust",
      "la-sust",
      "do7",
    ];
    const partitures = {
      "La Balanguera": [
        "do",
        "re",
        "mi",
        "fa",
        "fa",
        "sol",
        "la-sust",
        "la-sust",
      ],
      "Happy Birthday": [
        "do",
        "do",
        "re",
        "do",
        "fa",
        "mi",
        "do",
        "do",
        "re",
        "do",
        "sol",
        "fa",
      ],
    };
    let cerca = [];

    function Nota(nom) {
      this.nom = nom;
      this.src = `audio/${nom}.mp3`;
    }

    function sonarTecla(nota) {
      let n = new Nota(nota);
      let audio = new Audio(n.src);
      audio.play();
    }

    function borrarCerca() {
      cerca = [];
      document.querySelector("#cerca").innerHTML = "";
      document.querySelector("#resultats").innerHTML = "";
    }

    function assignarTeclesPiano() {
      for (let i = 0; i < notes.length; i++) {
        let nota = notes[i];
        let tecla = document
          .querySelector("#" + notes[i])
          .addEventListener("click", () => {
            sonarTecla(nota);
            cerca.push(nota);
            cercadorPartitures();
            document.querySelector("#cerca").innerHTML = cerca;
          });
      }
    }

    function cercadorPartitures() {
      document.querySelector("#resultats").innerHTML = "";
      let counter = 0;
      for (let partitura in partitures) {
        counter = 0;
        console.log("Partitura: " + partitura);
        for (let j = 0; j < partitures[partitura].length; j++) {
          if (partitures[partitura][j] === cerca[counter]) {
            console.log(
              "n-" +
                j +
                " - notaPartitura " +
                partitures[partitura][j] +
                " || n-" +
                counter +
                " -  nota Cerca: " +
                cerca[counter]
            );
            counter++;
          } else {
            counter = 0;
            break;
          }
          if (counter === cerca.length) {
            pintaPartitura(partitura);
            break;
          }
        }
      }
    }

    function pintaPartitura(partitura) {
      document.querySelector("#resultats").innerHTML += `
            <div>
              <div>
                  <h3>${partitura}</h3>
                  <p>Lletra</p>
              </div> 
                <div>
                  <button class="btn-red" onclick="reproduirPartitura('${partitura}')">Reproduir <br> can√ßo</button>
                </div>
              </div>
        `;
    }

    assignarTeclesPiano();

    function reproduirPartitura(partitura) {
      let partituraSeleccionada = partitures[partitura];
      let i = 0;
      let interval;
      let interval2 = clearInterval(interval);
      interval = setInterval(() => {
        sonarTecla(partituraSeleccionada[i]);
        i++;
        if (i >= partituraSeleccionada.length) {
          clearInterval(interval);
        }
      }, 500);
    }

    /* sonar tecla partitures

    function cercadorPartitures() {
      document.querySelector("#resultats").innerHTML = "";
      let counter = 0;
      for (let partitura in partitures) {
        counter = 0; 
        for (let j = 0; j < partitures[partitura].length; j++) {
          if (partitures[partitura][j] === cerca[counter]) { 
            counter++;

            if (counter === cerca.length) {
              console.log("Partitura trobada: " + partitura);
              document.querySelector("#resultats").innerHTML += `
              <div class="resultat">
                <p>${partitura}</p>
                <button class="btn-red" onclick="sonarPartitura('${partitura}')">Reproduir</button>
              </div>
              `;
              break;
            }
          } else {
            counter = 0;

          }
          

        } 
      }
    }





    document
      .querySelector("#balanguera")
      .addEventListener("click", () => sonarPartitura("balanguera"));
    document
      .querySelector("#happybirthday")
      .addEventListener("click", () => sonarPartitura("happybirthday"));
      
      document.querySelector("#resultats").innerHTML += `<p>${partitura}</p>`;
      
      let partituresKeys = Object.keys(partitures);
      let partituresValues = Object.values(partitures);
      let partituresValuesString = partituresValues.map((x) => x.join(" "));
      let cercaString = cerca.join(" ");
      let results = document.querySelector("#resultats");
      results.innerHTML = "";
      for (let i = 0; i < partituresValuesString.length; i++) {
        if (partituresValuesString[i].includes(cercaString)) {
          let p = document.createElement("p");
          p.innerHTML = partituresKeys[i];
          results.appendChild(p);
        }
      } 
      
      
      */
  </script>
</html>
