<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
  </head>
  <body>
    <label>Nom</label>
    <input type="text" id="nom" />

    <label for="sexe">Sexe</label>
    <input type="radio" id="MASC" name="sexe" value="MASC" checked />
    <label for="MASC">Masculí</label>

    <input type="radio" id="FEM" name="sexe" value="FEM" />
    <label for="FEM">Femení</label>

    <div for="numregistre" id="tipusRegistre"></div>

    <label for="tipus">Tipus:</label>
    <select name="tipus" id="tipus">
      <option value="no-elegit">Elegeix una opcio</option>
      <option id="ca" value="ca">Ca (de raça o no)</option>
      <option id="cavall" value="cavall">Cavall (de carreres o no)</option>
      <option id="moix" value="moix">Moix</option>
    </select>
    <br />
    <button id="desar">Desa</button>

    <script type="module">
      import { AnimalService } from "./controller/AnimalService.js";

      (async () => {
        document
          .querySelector("#desar")
          .addEventListener("click", async function () {
            //Recuperem les dades
            const nom = document.querySelector("#nom").value;
            const sexe = document.querySelector(
              'input[name="sexe"]:checked'
            ).value;
            const numregistre = document.querySelector("#numregistre").value;
            const tipus = document.querySelector("#tipus").value;

            const animalService = AnimalService.getInstance();
            const animalSaved = await animalService.save(
              nom,
              sexe,
              numregistre,
              tipus
            );
          });

        const variablesUrl = window.location.search;
        const urlParams = new URLSearchParams(variablesUrl);

        const id = urlParams.get("id");
        if (id) {
          const animalService = AnimalService.getInstance();
          const animal = await animalService.getAnimal(id);
          console.log(animal);
          pintarAnimal(animal);
        }

        displayTipus();
      })();

      function pintarAnimal(animal) {
        document.querySelector("#nom").value = animal.name;
        if (animal.sexe === "MASC") {
          document.querySelector("#MASC").checked = true;
        } else {
          document.querySelector("#FEM").checked = true;
        }
        if (animal.type === "ca") {
          document.querySelector("#ca").selected = true;
        } else if (animal.type === "cavall") {
          document.querySelector("#cavall").selected = true;
        } else {
          document.querySelector("#moix").selected = true;
        }
        document.querySelector("#numregistre").value = animal.register; 
      }

      function displayTipus() {
        const tipus = document
          .querySelector("#tipus")
          .addEventListener("change", () => {
            const value = document.querySelector("#tipus").value;
            if (value === "ca") {
              document.querySelector("#tipusRegistre").style.display = "block";
              document.querySelector("#tipusRegistre").innerHTML =
                "Número de registre ";
              document.querySelector(
                "#tipusRegistre"
              ).innerHTML += `<input type="text" id="numregistre" />`;
            } else if (value === "cavall") {
              document.querySelector("#tipusRegistre").style.display = "block";
              document.querySelector("#tipusRegistre").innerHTML =
                "Número de federat ";
              document.querySelector(
                "#tipusRegistre"
              ).innerHTML += `<input type="text" id="numregistre" />`;
            } else {
              document.querySelector("#tipusRegistre").style.display = "none";
              document.querySelector(
                "#tipusRegistre"
              ).innerHTML += `<input type="text" id="numregistre" value="0">`;
            }
          });
      }
    </script>
  </body>
</html>
